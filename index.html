<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Queen of Hell — Jyoti Siddhanta</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Cinzel+Decorative:wght@400;700;900&family=MedievalSharp&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{min-height:100vh;background:linear-gradient(180deg,#0a0004 0%,#150008 30%,#0d0005 60%,#05000a 100%);color:#ddd;font-family:Georgia,'Times New Roman',serif;overflow-x:hidden}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:rgba(10,0,4,.5)}
::-webkit-scrollbar-thumb{background:rgba(139,0,0,.4);border-radius:3px}
@keyframes flicker{0%,100%{opacity:1}50%{opacity:.85}}
@keyframes slide-in{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

.bg-effects{position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 800px 600px at 20% 20%,rgba(80,0,0,.15),transparent),radial-gradient(ellipse 600px 800px at 80% 80%,rgba(60,0,20,.1),transparent),radial-gradient(ellipse 400px 400px at 50% 50%,rgba(40,0,0,.08),transparent)}
.bg-pattern{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ff0000' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")}

.wrap{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 16px}
.cinzel{font-family:'Cinzel',serif}
.cinzel-d{font-family:'Cinzel Decorative','Cinzel',serif}
.mono{font-family:monospace}

header{padding:30px 0 20px;text-align:center;border-bottom:1px solid rgba(200,50,50,.15);margin-bottom:24px}
.subtitle{font-size:11px;letter-spacing:6px;color:rgba(200,80,80,.5);text-transform:uppercase}
h1{font-size:clamp(28px,5vw,42px);font-weight:900;background:linear-gradient(180deg,#ff4444 0%,#8b0000 40%,#4a0000 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:4px;filter:drop-shadow(0 0 20px rgba(139,0,0,.5));animation:flicker 4s ease-in-out infinite}
.tagline{font-size:10px;letter-spacing:8px;color:rgba(200,100,100,.35);text-transform:uppercase;margin-top:6px}
.header-line{width:120px;height:1px;margin:16px auto 0;background:linear-gradient(90deg,transparent,rgba(200,50,50,.4),transparent)}

.panel{background:rgba(10,2,5,.6);border:1px solid rgba(200,50,50,.15);border-radius:6px;padding:20px;margin-bottom:24px;backdrop-filter:blur(10px)}
.section-label{font-size:9px;letter-spacing:4px;color:rgba(200,80,80,.5);text-transform:uppercase;margin-bottom:14px}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
label{font-size:9px;color:rgba(200,100,100,.5);font-family:'Cinzel',serif;letter-spacing:1px;display:block;margin-bottom:4px}
input,select{background:rgba(20,5,10,.8)!important;border:1px solid rgba(200,50,50,.25)!important;color:#ddd!important;padding:8px 10px!important;border-radius:3px!important;font-family:Georgia,serif!important;font-size:13px!important;outline:none!important;transition:border-color .3s!important;width:100%}
input:focus,select:focus{border-color:rgba(255,80,80,.5)!important;box-shadow:0 0 10px rgba(139,0,0,.3)!important}
select option{background:#150008;color:#ddd}

.btn{background:rgba(139,0,0,.3);border:1px solid rgba(200,50,50,.3);color:rgba(200,150,150,.7);padding:6px 14px;border-radius:3px;cursor:pointer;font-family:'Cinzel',serif;font-size:10px;letter-spacing:1px;transition:all .3s}
.btn:hover{background:rgba(139,0,0,.5)}
.btn.active{background:rgba(139,0,0,.4)}
.btn-row{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap}

.tabs{display:flex;gap:2px;margin-bottom:2px;border-bottom:1px solid rgba(200,50,50,.15)}
.tab{background:transparent;border:none;border-bottom:2px solid transparent;color:rgba(200,150,150,.4);padding:10px 20px;cursor:pointer;font-family:'Cinzel',serif;font-size:11px;letter-spacing:2px;transition:all .3s;text-transform:uppercase}
.tab.active{background:linear-gradient(180deg,rgba(139,0,0,.3),rgba(80,0,0,.15));border-bottom:2px solid #8b0000;color:#ff6666}

.content{background:rgba(10,2,5,.4);border:1px solid rgba(200,50,50,.1);border-top:none;border-radius:0 0 6px 6px;padding:20px;animation:slide-in .3s ease-out;min-height:400px}

/* Chart grid */
.chart-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:2px;width:100%;aspect-ratio:1;background:rgba(139,0,0,.15);border:2px solid rgba(200,50,50,.4);border-radius:4px;box-shadow:0 0 30px rgba(139,0,0,.2),inset 0 0 30px rgba(0,0,0,.3)}
.chart-cell{background:rgba(15,3,8,.85);padding:4px;display:flex;flex-direction:column;min-height:0;overflow:hidden;transition:all .3s}
.chart-cell.asc{background:linear-gradient(135deg,rgba(139,0,0,.3),rgba(80,0,0,.2));border-left:2px solid rgba(255,80,80,.5)}
.chart-cell.center{background:rgba(20,5,10,.9);display:flex;align-items:center;justify-content:center}
.sign-label{font-size:9px;color:rgba(200,150,150,.5);font-family:'Cinzel',serif}
.sign-label.asc{color:rgba(255,120,120,.9);font-weight:bold}
.sign-sym{font-size:11px;color:rgba(200,150,150,.25)}
.sign-sym.asc{color:rgba(255,100,100,.7)}
.planet-tag{font-size:10px;font-weight:bold;font-family:monospace;line-height:1.2}

/* Info cards */
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:8px;margin-top:20px}
.info-card{padding:8px 12px;background:rgba(20,5,10,.5);border-left:2px solid rgba(200,50,50,.25);border-radius:2px}
.info-card-label{font-size:8px;color:rgba(200,100,100,.5);font-family:'Cinzel',serif;letter-spacing:2px;margin-bottom:2px;text-transform:uppercase}
.info-card-value{font-size:13px;color:rgba(255,150,150,.8);font-family:'Cinzel',serif}

/* Graha table */
.graha-table{width:100%;border-collapse:collapse;font-size:11px;font-family:monospace;overflow-x:auto;display:block}
.graha-table th{padding:6px 4px;text-align:left;color:rgba(200,100,100,.7);font-family:'Cinzel',serif;font-size:9px;letter-spacing:1px;font-weight:normal;border-bottom:1px solid rgba(200,50,50,.3)}
.graha-table td{padding:4px;border-bottom:1px solid rgba(100,20,20,.15)}

/* Dasha */
.dasha-item{display:flex;align-items:center;gap:8px;padding:6px 10px;background:rgba(20,5,10,.5);border-left:3px solid rgba(100,30,30,.3);border-radius:2px;margin-bottom:4px;transition:all .3s}
.dasha-item.active{background:linear-gradient(90deg,rgba(139,0,0,.4),rgba(80,0,0,.1));border-left:3px solid #ff4444}

/* Panchanga */
.panch-row{display:flex;justify-content:space-between;padding:5px 8px;background:rgba(20,5,10,.5);border-left:2px solid rgba(200,50,50,.2);border-radius:2px;margin-bottom:6px}
.panch-label{font-size:10px;color:rgba(200,100,100,.6);font-family:'Cinzel',serif;letter-spacing:1px}
.panch-value{font-size:11px;color:rgba(200,150,150,.7);font-family:monospace}

.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.detail-item{padding:5px 8px;background:rgba(20,5,10,.5);border-left:2px solid rgba(200,50,50,.15);border-radius:2px}
.detail-item span:first-child{font-size:9px;color:rgba(200,100,100,.5);font-family:'Cinzel',serif;letter-spacing:1px}
.detail-item span:last-child{font-size:11px;color:rgba(200,150,150,.6);font-family:monospace}

footer{padding:30px 0;text-align:center;border-top:1px solid rgba(200,50,50,.08);margin-top:30px}
</style>
</head>
<body>
<div class="bg-effects"></div>
<div class="bg-pattern"></div>

<div class="wrap">
  <header>
    <div class="subtitle cinzel">⛧ Jyoti Siddhanta ⛧</div>
    <h1 class="cinzel-d">QUEEN OF HELL</h1>
    <div class="tagline cinzel">Realm of Munch Munch</div>
    <div class="header-line"></div>
  </header>

  <!-- Birth Data -->
  <div class="panel">
    <div class="section-label cinzel">✧ Birth Data ✧</div>
    <div class="form-grid">
      <div><label>Name</label><input id="inp-name" type="text" value="New Delhi"></div>
      <div><label>Date of Birth</label><input id="inp-date" type="date" value="1990-01-15"></div>
      <div><label>Time of Birth</label><input id="inp-time" type="time" value="06:30" step="60"></div>
      <div><label>Latitude</label><input id="inp-lat" type="number" step="0.0001" value="28.6139"></div>
      <div><label>Longitude</label><input id="inp-lon" type="number" step="0.0001" value="77.2090"></div>
      <div><label>Ayanāṃśa</label><select id="inp-ayan"><option value="lahiri">Lahiri</option><option value="raman">Raman</option><option value="citra">True Citrā</option></select></div>
    </div>
    <div class="btn-row">
      <button class="btn" id="btn-style">☽ South Indian</button>
      <button class="btn" id="btn-d9">⛧ D1 Only</button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="chart">Chart</button>
    <button class="tab" data-tab="planets">Graha</button>
    <button class="tab" data-tab="dasha">Daśā</button>
    <button class="tab" data-tab="panchanga">Pañcāṅga</button>
  </div>

  <!-- Content -->
  <div class="content" id="content"></div>

  <footer>
    <div class="cinzel" style="font-size:10px;color:rgba(200,80,80,.25);letter-spacing:3px">⛧ QUEEN OF HELL ⛧</div>
    <div class="cinzel" style="font-size:8px;color:rgba(200,100,100,.2);letter-spacing:2px;margin-top:6px">Planetary positions are approximate • For precise calculations use Swiss Ephemeris</div>
  </footer>
</div>

<script>
// ─── DATA ──────────────────────────────────────────────────────────
const SIGNS=["Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"];
const SIGN_ABBR=["Ar","Ta","Ge","Cn","Le","Vi","Li","Sc","Sg","Cp","Aq","Pi"];
const SIGN_SYMBOLS=["♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓"];
const NAKSHATRAS=["Ashwini","Bharani","Krittika","Rohini","Mrigashira","Ardra","Punarvasu","Pushya","Ashlesha","Magha","Purva Phalguni","Uttara Phalguni","Hasta","Chitra","Swati","Vishakha","Anuradha","Jyeshtha","Mula","Purva Ashadha","Uttara Ashadha","Shravana","Dhanishta","Shatabhisha","Purva Bhadra","Uttara Bhadra","Revati"];
const NAK_LORDS=["Ke","Ve","Su","Mo","Ma","Ra","Jp","Sa","Me","Ke","Ve","Su","Mo","Ma","Ra","Jp","Sa","Me","Ke","Ve","Su","Mo","Ma","Ra","Jp","Sa","Me"];
const PLANETS=[
  {id:"Su",name:"Sun",sanskrit:"Sūrya",symbol:"☉",color:"#ff4444"},
  {id:"Mo",name:"Moon",sanskrit:"Chandra",symbol:"☽",color:"#c0c0ff"},
  {id:"Ma",name:"Mars",sanskrit:"Maṅgala",symbol:"♂",color:"#ff2200"},
  {id:"Me",name:"Mercury",sanskrit:"Budha",symbol:"☿",color:"#44cc44"},
  {id:"Jp",name:"Jupiter",sanskrit:"Guru",symbol:"♃",color:"#ffaa00"},
  {id:"Ve",name:"Venus",sanskrit:"Śukra",symbol:"♀",color:"#ff66ff"},
  {id:"Sa",name:"Saturn",sanskrit:"Śani",symbol:"♄",color:"#6666cc"},
  {id:"Ra",name:"Rahu",sanskrit:"Rāhu",symbol:"☊",color:"#888888"},
  {id:"Ke",name:"Ketu",sanskrit:"Ketu",symbol:"☋",color:"#999966"},
];
const DASHA_YEARS={Ke:7,Ve:20,Su:6,Mo:10,Ma:7,Ra:18,Jp:16,Sa:19,Me:17};
const DASHA_ORDER=["Ke","Ve","Su","Mo","Ma","Ra","Jp","Sa","Me"];

// ─── MATH ──────────────────────────────────────────────────────────
const norm=d=>((d%360)+360)%360;
const signIdx=l=>Math.floor(l/30);
const degInSign=l=>l%30;
const nakIdx=l=>Math.floor(l/(360/27));
const nakPada=l=>Math.floor((l%(360/27))/(360/108))+1;
function fmtDeg(d){const deg=Math.floor(d),m=Math.floor((d-deg)*60),s=Math.floor(((d-deg)*60-m)*60);return`${deg}°${String(m).padStart(2,'0')}'${String(s).padStart(2,'0')}''`}

function getAyanamsa(jd){return 23.85+0.0137*(jd-2415020)/365.25}
function dateToJD(y,mo,d,h){let yr=y,mn=mo;if(mn<=2){yr--;mn+=12}const A=Math.floor(yr/100),B=2-A+Math.floor(A/4);return Math.floor(365.25*(yr+4716))+Math.floor(30.6001*(mn+1))+d+h/24+B-1524.5}

function calcPlanets(jd){
  const T=(jd-2451545)/36525,ay=getAyanamsa(jd);
  const sML=norm(280.46646+36000.76983*T+.0003032*T*T);
  const sA=norm(357.52911+35999.05029*T-.0001537*T*T);
  const sEq=(1.9146-.004817*T)*Math.sin(sA*Math.PI/180)+.019993*Math.sin(2*sA*Math.PI/180);
  const sL=norm(sML+sEq-ay);
  const mML=norm(218.3165+481267.8813*T),mA=norm(134.9634+477198.8676*T);
  const mEv=1.2739*Math.sin((2*(mML-sML)-mA)*Math.PI/180);
  const mL=norm(mML+6.2888*Math.sin(mA*Math.PI/180)+mEv-ay);
  const maL=norm(355.433+19140.2993*T-ay+2.5*Math.sin(19140.2993*T*.1*Math.PI/180));
  const meL=norm(252.251+149472.6746*T-ay+3*Math.sin(149472.6746*T*.01*Math.PI/180));
  const jL=norm(34.351+3034.9057*T-ay+5.5*Math.sin(3034.9057*T*.05*Math.PI/180));
  const vL=norm(181.979+58517.8155*T-ay+.8*Math.sin(58517.8155*T*.01*Math.PI/180));
  const saL=norm(50.077+1222.1138*T-ay+6.4*Math.sin(1222.1138*T*.05*Math.PI/180));
  const rL=norm(125.044-1934.1366*T-ay),kL=norm(rL+180);
  return PLANETS.map((p,i)=>({...p,longitude:[sL,mL,maL,meL,jL,vL,saL,rL,kL][i]}));
}
function calcAsc(jd,lat,lon){
  const T=(jd-2451545)/36525,ay=getAyanamsa(jd);
  const GMST=280.46061837+360.98564736629*(jd-2451545)+.000387933*T*T;
  const LST=((GMST+lon)%360+360)%360;
  const obl=(23.4393-.013*T)*Math.PI/180,latR=lat*Math.PI/180,lstR=LST*Math.PI/180;
  const aR=Math.atan2(Math.cos(lstR),-(Math.sin(obl)*Math.tan(latR)+Math.cos(obl)*Math.sin(lstR)));
  return(aR*180/Math.PI+360-ay+360)%360;
}
function calcNavamsa(planets){
  return planets.map(p=>{
    const s=signIdx(p.longitude),d=degInSign(p.longitude),pada=Math.floor(d/3.333333);
    let ns;
    if([0,4,8].includes(s))ns=(s+pada)%12;
    else if([1,5,9].includes(s))ns=(s+9+pada)%12;
    else if([2,6,10].includes(s))ns=(s+6+pada)%12;
    else ns=(s+3+pada)%12;
    return{...p,longitude:ns*30+(d%3.333)*9};
  });
}
function calcDasha(moonL,jd){
  const ni=nakIdx(moonL),lord=NAK_LORDS[ni],si=DASHA_ORDER.indexOf(lord);
  const elapsed=(moonL-ni*(360/27))/(360/27);
  const rem=DASHA_YEARS[lord]*(1-elapsed);
  const ds=[];let cur=new Date((jd-2440587.5)*864e5);
  for(let i=0;i<9;i++){
    const idx=(si+i)%9,l=DASHA_ORDER[idx],y=i===0?rem:DASHA_YEARS[l];
    const st=new Date(cur);cur=new Date(cur.getTime()+y*365.25*864e5);
    ds.push({lord:l,years:Math.round(y*10)/10,start:st,end:new Date(cur)});
  }return ds;
}
function calcPanchanga(sL,mL){
  const ta=((mL-sL+360)%360),tn=Math.floor(ta/12)+1;
  const tNames=["Pratipada","Dvitiya","Tritiya","Chaturthi","Panchami","Shashthi","Saptami","Ashtami","Navami","Dashami","Ekadashi","Dvadashi","Trayodashi","Chaturdashi","Purnima/Amavasya"];
  const paksha=ta<180?"Shukla":"Krishna";
  const ya=(sL+mL)%360,yn=Math.floor(ya/(360/27))+1;
  const yNames=["Vishkambha","Priti","Ayushman","Saubhagya","Shobhana","Atiganda","Sukarma","Dhriti","Shula","Ganda","Vriddhi","Dhruva","Vyaghata","Harshana","Vajra","Siddhi","Vyatipata","Variyan","Parigha","Shiva","Siddha","Sadhya","Shubha","Shukla","Brahma","Indra","Vaidhriti"];
  const kn=Math.floor(ta/6)%11;
  const kNames=["Bava","Balava","Kaulava","Taitila","Garaja","Vanija","Vishti","Shakuni","Chatushpada","Naga","Kimstughna"];
  return{tithi:`${paksha} ${tNames[(tn-1)%15]}`,yoga:yNames[(yn-1)%27],karana:kNames[kn]};
}

// ─── STATE ─────────────────────────────────────────────────────────
let state={tab:"chart",style:"south",showD9:false};

function getInputs(){
  return{
    name:document.getElementById("inp-name").value,
    date:document.getElementById("inp-date").value,
    time:document.getElementById("inp-time").value,
    lat:parseFloat(document.getElementById("inp-lat").value)||0,
    lon:parseFloat(document.getElementById("inp-lon").value)||0,
  };
}

function compute(){
  const inp=getInputs();
  const[y,m,d]=inp.date.split("-").map(Number);
  const[h,mn]=inp.time.split(":").map(Number);
  const hour=h+mn/60;
  const jd=dateToJD(y,m,d,hour-(inp.lon/15));
  const planets=calcPlanets(jd);
  const asc=calcAsc(jd,inp.lat,inp.lon);
  const ascS=signIdx(asc);
  const nav=calcNavamsa(planets);
  const navAsc=signIdx(calcNavamsa([{longitude:asc}])[0].longitude);
  const dashas=calcDasha(planets[1].longitude,jd);
  const panch=calcPanchanga(planets[0].longitude,planets[1].longitude);
  return{planets,asc,ascS,nav,navAsc,dashas,panch,jd,inp};
}

// ─── RENDERERS ─────────────────────────────────────────────────────
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

function renderSouthChart(planets,ascS,title){
  const grid=[[11,0,1,2],[10,-1,-1,3],[9,-1,-1,4],[8,7,6,5]];
  const bySign={};planets.forEach(p=>{const s=signIdx(p.longitude);(bySign[s]=bySign[s]||[]).push(p)});
  let html='<div class="chart-grid">';
  grid.flat().forEach((si,i)=>{
    if(si===-1){
      html+=`<div class="chart-cell center">${i===5?`<span class="cinzel" style="font-size:11px;color:rgba(200,80,80,.6);letter-spacing:2px">${title||''}</span>`:''}</div>`;
      return;
    }
    const isAsc=si===ascS;const ps=bySign[si]||[];
    html+=`<div class="chart-cell${isAsc?' asc':''}">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2px">
        <span class="sign-label${isAsc?' asc':" "}">${SIGN_ABBR[si]}</span>
        <span class="sign-sym${isAsc?' asc':''}">${SIGN_SYMBOLS[si]}</span>
      </div>
      ${isAsc?'<span style="position:absolute;top:2px;right:2px;font-size:7px;color:rgba(255,80,80,.7)" class="cinzel">As</span>':''}
      <div style="display:flex;flex-wrap:wrap;gap:2px;flex:1">
        ${ps.map(p=>`<span class="planet-tag" style="color:${p.color};text-shadow:0 0 6px ${p.color}50">${p.id} ${fmtDeg(degInSign(p.longitude)).split("'")[0]}'</span>`).join('')}
      </div>
    </div>`;
  });
  return html+'</div>';
}

function renderChartTab(data){
  const c=data;
  let chartHtml=renderSouthChart(state.style==='south'?c.planets:c.planets,c.ascS,'D1');
  // For north style we reuse south for simplicity in the HTML version
  let html=`<div style="display:grid;grid-template-columns:${state.showD9?'1fr 1fr':'1fr'};gap:20px;max-width:${state.showD9?'100%':'500px'};margin:0 auto">`;
  html+=`<div><div class="section-label cinzel" style="text-align:center;margin-bottom:8px">✧ Rāśi Chart (D1) ✧</div>${renderSouthChart(c.planets,c.ascS,'D1')}</div>`;
  if(state.showD9){
    html+=`<div><div class="section-label cinzel" style="text-align:center;margin-bottom:8px">✧ Navāṃśa Chart (D9) ✧</div>${renderSouthChart(c.nav,c.navAsc,'D9')}</div>`;
  }
  html+='</div>';
  // Quick info
  html+='<div class="info-grid">';
  const infos=[
    ["Lagna",`${SIGNS[c.ascS]} ${fmtDeg(degInSign(c.asc))}`],
    ["Moon Sign",SIGNS[signIdx(c.planets[1].longitude)]],
    ["Sun Sign",SIGNS[signIdx(c.planets[0].longitude)]],
    ["Nakṣatra",`${NAKSHATRAS[nakIdx(c.planets[1].longitude)]} (Pada ${nakPada(c.planets[1].longitude)})`],
  ];
  infos.forEach(([l,v])=>{html+=`<div class="info-card"><div class="info-card-label">${l}</div><div class="info-card-value">${v}</div></div>`});
  html+='</div>';
  return html;
}

function renderPlanetsTab(data){
  const c=data;
  let html=`<div class="section-label cinzel">✧ Graha Positions ✧</div><div style="overflow-x:auto"><table class="graha-table"><thead><tr>`;
  ["","Body","Sanskrit","Rāśi","Longitude","Nakṣatra","Pada","Lord"].forEach(h=>{html+=`<th>${h}</th>`});
  html+='</tr></thead><tbody>';
  // Ascendant row
  const as=c.ascS;
  html+=`<tr><td style="color:#ff8888">↑</td><td style="color:#ff8888">As</td><td style="color:rgba(200,150,150,.5)">Lagna</td><td style="color:rgba(255,150,150,.8)">${SIGNS[as]}</td><td style="color:rgba(200,150,150,.6)">${SIGN_ABBR[as]} ${fmtDeg(degInSign(c.asc))}</td><td style="color:rgba(200,150,150,.5)">${NAKSHATRAS[nakIdx(c.asc)]}</td><td style="color:rgba(200,150,150,.4)">${nakPada(c.asc)}</td><td style="color:rgba(200,150,150,.4)">${NAK_LORDS[nakIdx(c.asc)]}</td></tr>`;
  c.planets.forEach(p=>{
    const si=signIdx(p.longitude),ni=nakIdx(p.longitude);
    html+=`<tr><td style="color:${p.color};font-size:13px">${p.symbol}</td><td style="color:${p.color};font-weight:bold">${p.id}</td><td style="color:rgba(200,150,150,.5)">${p.sanskrit}</td><td style="color:rgba(255,150,150,.7)">${SIGNS[si]}</td><td style="color:rgba(200,150,150,.6)">${SIGN_ABBR[si]} ${fmtDeg(degInSign(p.longitude))}</td><td style="color:rgba(200,150,150,.5)">${NAKSHATRAS[ni]}</td><td style="color:rgba(200,150,150,.4)">${nakPada(p.longitude)}</td><td style="color:rgba(200,150,150,.4)">${NAK_LORDS[ni]}</td></tr>`;
  });
  html+='</tbody></table></div>';
  return html;
}

function renderDashaTab(data){
  const c=data,now=new Date();
  const ni=nakIdx(c.planets[1].longitude);
  let html=`<div class="section-label cinzel">✧ Viṁśottarī Mahā Daśā ✧</div>`;
  html+=`<div class="mono" style="font-size:10px;color:rgba(200,150,150,.4);margin-bottom:14px">Starting Nakṣatra: ${NAKSHATRAS[ni]} (${NAK_LORDS[ni]})</div>`;
  c.dashas.forEach(d=>{
    const active=now>=d.start&&now<d.end;
    const planet=PLANETS.find(p=>p.id===d.lord);
    html+=`<div class="dasha-item${active?' active':''}">
      <span style="font-size:14px;color:${planet?.color||'#fff'};${active?`text-shadow:0 0 10px ${planet?.color}80`:''};width:20px">${planet?.symbol||''}</span>
      <span class="cinzel" style="font-size:12px;color:${active?'#ff8888':'rgba(200,150,150,.6)'};width:30px;${active?'font-weight:bold':''}">${d.lord}</span>
      <span class="mono" style="font-size:10px;color:rgba(200,150,150,.4);flex:1">${d.start.getFullYear()} — ${d.end.getFullYear()}</span>
      <span class="mono" style="font-size:10px;color:rgba(200,150,150,.35)">${d.years}y</span>
    </div>`;
  });
  return html;
}

function renderPanchangaTab(data){
  const c=data,vara=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date().getDay()];
  const varaL=["Su","Mo","Ma","Me","Jp","Ve","Sa"][new Date().getDay()];
  let html=`<div class="section-label cinzel">✧ Pañcāṅga ✧</div>`;
  [["Vāra",`${vara} (${varaL})`],["Tithi",c.panch.tithi],["Nakṣatra",NAKSHATRAS[nakIdx(c.planets[1].longitude)]],["Yoga",c.panch.yoga],["Karaṇa",c.panch.karana]].forEach(([l,v])=>{
    html+=`<div class="panch-row"><span class="panch-label">${l}</span><span class="panch-value">${v}</span></div>`;
  });
  html+=`<div class="section-label cinzel" style="margin-top:20px;margin-bottom:10px">✧ Chart Details ✧</div><div class="detail-grid">`;
  [["Ayanāṃśa",fmtDeg(getAyanamsa(c.jd))],["Julian Day",c.jd.toFixed(4)],["Coordinates",`${c.inp.lat}, ${c.inp.lon}`],["Chart Style","South Indian"]].forEach(([l,v])=>{
    html+=`<div class="detail-item"><span>${l}: </span><span>${v}</span></div>`;
  });
  html+='</div>';
  return html;
}

// ─── RENDER ────────────────────────────────────────────────────────
function render(){
  const data=compute();
  const el=document.getElementById("content");
  switch(state.tab){
    case"chart":el.innerHTML=renderChartTab(data);break;
    case"planets":el.innerHTML=renderPlanetsTab(data);break;
    case"dasha":el.innerHTML=renderDashaTab(data);break;
    case"panchanga":el.innerHTML=renderPanchangaTab(data);break;
  }
}

// ─── EVENTS ────────────────────────────────────────────────────────
document.querySelectorAll(".tab").forEach(t=>{
  t.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    state.tab=t.dataset.tab;
    render();
  });
});
document.getElementById("btn-style").addEventListener("click",function(){
  state.style=state.style==="south"?"north":"south";
  this.textContent=state.style==="south"?"☽ South Indian":"☽ North Indian";
  render();
});
document.getElementById("btn-d9").addEventListener("click",function(){
  state.showD9=!state.showD9;
  this.textContent=state.showD9?"⛧ D1 + D9":"⛧ D1 Only";
  this.classList.toggle("active",state.showD9);
  render();
});
["inp-name","inp-date","inp-time","inp-lat","inp-lon","inp-ayan"].forEach(id=>{
  document.getElementById(id).addEventListener("change",render);
});

// Initial render
render();
</script>
</body>
</html>
